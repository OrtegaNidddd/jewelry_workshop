@startuml SecuenciaRechazo

title Diagrama de Secuencia - Flujo con Rechazos y Ajustes
title Diagrama de Secuencia - Flujo con Rechazos y Ajustes

actor Cliente
participant Asesor
participant Diseñador
participant Maestro

== Fase de Pedido ==
Cliente -> Asesor: Realizar pedido
Asesor --> Cliente: Confirmar recepción

== Fase de Diseño ==
Asesor -> Diseñador: Solicitar diseño
activate Diseñador
Diseñador -> Diseñador: Realizar diseño
Diseñador -> Cliente: Enviar diseño a cliente
deactivate Diseñador

Cliente -> Cliente: Revisar diseño
Cliente -> Asesor: Rechazar diseño
Cliente -> Asesor: Solicitar ajustes
Asesor --> Cliente: Notificar recepción de rechazo

Asesor -> Diseñador: Solicitar ajustes al diseño
activate Diseñador
Diseñador -> Diseñador: Realizar ajustes al diseño
Diseñador -> Cliente: Enviar diseño ajustado a cliente
deactivate Diseñador

Cliente -> Cliente: Revisar diseño ajustado
Cliente -> Asesor: Aprobar diseño
Asesor --> Cliente: Notificar recepción de aprobación

== Fase de Cotización ==
note over Asesor: Precondición:\nDiseño aprobado
Asesor -> Asesor: Realizar cotización
Asesor -> Cliente: Enviar cotización a cliente

Cliente -> Cliente: Revisar cotización
Cliente -> Asesor: Rechazar cotización
Cliente -> Asesor: Solicitar ajustes
Asesor --> Cliente: Notificar recepción de decisión

Asesor -> Asesor: Realizar ajustes a cotización
Asesor -> Cliente: Enviar cotización ajustada a cliente

Cliente -> Cliente: Revisar cotización ajustada
Cliente -> Asesor: Aprobar cotización
Asesor --> Cliente: Notificar recepción de decisión

== Fase de Fabricación ==
note over Asesor: Precondición:\nCotización aprobada
Asesor -> Maestro: Asignar maestro al pedido

activate Maestro
Maestro -> Maestro: Fabricar pieza
Maestro -> Asesor: Notificar pieza terminada
deactivate Maestro

== Fase de Entrega ==
Asesor -> Asesor: Realizar control de calidad

alt Control de calidad aprobado
    Asesor -> Cliente: Entregar pieza a cliente
    Cliente -> Cliente: Recibir pieza
else Control de calidad rechazado
    Asesor -> Maestro: Solicitar corrección de defectos
    Maestro -> Maestro: Corregir defectos
    Maestro -> Asesor: Notificar corrección completada
    Asesor -> Asesor: Realizar control de calidad nuevamente
    Asesor -> Cliente: Entregar pieza a cliente
    Cliente -> Cliente: Recibir pieza
end

@enduml